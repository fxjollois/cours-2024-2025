<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Production scientifique mondiale</title>
        <script src="plotly-2.35.2.min.js" charset="utf-8"></script>
        <script src="top_regions.js"></script>
        <script src="par_annee.js"></script>
        <script src="documents_citations.json"></script>
        <style>
            #top_regions, #par_annee {
                
            }
        </style>
    </head>
    <body>

        <div>
        <div id = "top_regions"></div>
        <div id = "par_annee"></div>
        </div>
        <div id = "documents_citations"></div>
        <script>
            var trace_top_regions = [
                {
                    y: top_regions.map(function(e) { return e.Region }),
                    x: top_regions.map(function(e) { return e.Documents }),
                    type: "bar",
                    marker: { color: "darkgrey" },
                    orientation: "h"
                }
            ];
            Plotly.newPlot("top_regions", trace_top_regions, {},  { displayModeBar: false });
            
            var regions = top_regions.map(function(e) { return e.Region }),
                traces_par_annee = regions.map(function(e) { 
                    return {
                        x: par_annee.map(function(d) { return d.Year; }),
                        y: par_annee.map(function(d) { return d[e]; }),
                        name: e,
                        type : "scatter",
                        marker: { color: "darkgrey" }
                    }
                });
            Plotly.newPlot("par_annee", traces_par_annee, {},  { displayModeBar: false });
            
            var traces_documents_citations = {
                x: documents_citations.map(function(e) { return e.Documents; }),
                y: documents_citations.map(function(e) { return e.Citations; }),
                text: documents_citations.map(function(e) { return e.Country; }),
                type: "scatter",
                mode: "markers"
            }
            Plotly.newPlot("documents_citations", [traces_documents_citations], {},  { displayModeBar: false });
        </script>
        <script>
            document.getElementById("top_regions").on(
                'plotly_click', 
                function(e) {
                    console.log(e);
                    var infos = e.points[0],
                        couleurs_regions = top_regions.map(function(d) { return d.Region == infos.label ? "DarkRed" : "lightgray" }),
                        couleurs_pays = documents_citations.map(function(d) { return d.Region == infos.label ? "DarkRed" : "lightgray" });
                    Plotly.restyle("top_regions", { "marker.color": [couleurs_regions] })
                    Plotly.restyle("par_annee", { "marker.color": "lightgray", opacity: 0.5 })
                    Plotly.restyle("par_annee", { "marker.color": "DarkRed", opacity: 1 }, [infos.pointIndex])
                    Plotly.restyle("documents_citations", { "marker.color": [couleurs_pays], opacity: 1 })
                });
            
            document.getElementById("top_regions").on(
                'plotly_doubleclick', 
                function(e){
                    Plotly.restyle("top_regions", { "marker.color": "DarkGray" })                    
                    Plotly.restyle("par_annee", { "marker.color": "DarkGray", opacity: 1 })
                });
        </script>

    </body>
</html>
